services:
  lume_back_service:
    depends_on:
      - lume_celery_worker
      - lume_celery_beat 
    container_name: lume_back
    volumes:
      - analytics:/app/src/analytics/data
    image: lume-api-image:latest
    ports:
      - "7777:8000"
    networks:
      - LumeNetwork

  lume_celery_worker:
    container_name: lume_celery_worker
    volumes:
      - analytics:/app/src/analytics/data
    image: lume-api-image:latest
    networks:
      - LumeNetwork
    command: "celery --app=src.tasks.celery_app:celery_app worker -l INFO --pool=solo" 
  
  lume_celery_beat:
    container_name: lume_celery_beat
    volumes:
      - analytics:/app/src/analytics/data
    image: lume-api-image:latest
    networks:
      - LumeNetwork
    command: "celery --app=src.tasks.celery_app:celery_app beat -l INFO"


volumes:
  db_data:
  analytics:

networks:
  LumeNetwork:
    external: true